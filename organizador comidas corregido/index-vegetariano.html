<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Organizador de Comidas Semanales - Vegetariano</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --primario:#8f9d68; --fondo:#f9f9f9; --borde:#ddd; --texto:#333; }
    body { font-family:'Segoe UI',sans-serif; background:var(--fondo); color:var(--texto); margin:0; padding:20px; line-height:1.6; }
    h1,h2,h3 { color:var(--primario); margin-bottom:10px; }
    select,button,input,textarea { margin:10px 0; padding:10px; width:100%; max-width:400px; border:1px solid var(--borde); border-radius:6px; font-size:16px; }
    button { background:var(--primario); color:#fff; border:none; cursor:pointer; transition:background .3s; }
    button:hover { background:#0088cc; }
    #mensaje { margin:20px; font-weight:bold; }
    table { width:100%; max-width:800px; margin:30px auto 0; border-collapse:collapse; }
    th,td { border:1px solid var(--borde); padding:12px; text-align:center; }
    td:hover { background:#f0f0f0; }
    td.selected { border:2px solid var(--primario); background:#e6f7ff; }
    .menu-eliminar { display:inline-block; margin-top:5px; background:#bbb; color:#fff; font-size:11px; padding:3px 6px; border-radius:3px; cursor:pointer; }
    .top-buttons { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:30px; }
    .top-buttons button { padding:8px 12px; font-size:14px; width:auto; }
    @media (max-width:600px){
      table, thead, tbody, th, td, tr { display:block; }
      thead{ display:none; }
      tr{ margin-bottom:15px; background:#fff; border:1px solid var(--borde); border-radius:6px; padding:10px; }
      td{ text-align:left; border:none; border-bottom:1px solid var(--borde); position:relative; padding-left:50%; }
      td::before{ position:absolute; top:10px; left:10px; width:45%; padding-right:10px; white-space:nowrap; content:attr(data-label); font-weight:bold; color:var(--primario); }
      td:last-child{ border-bottom:none; }
    }
    .plato-saludable{ width:400px; max-width:100%; height:auto; }
    .mensaje-toast{ position:fixed; bottom:20px; left:50%; transform:translateX(-50%); min-width:280px; max-width:90%; padding:12px 18px; border-radius:8px; font-size:15px; font-weight:500; color:#fff; box-shadow:0 4px 12px rgba(0,0,0,.2); display:none; z-index:1000; animation:fadein .3s ease, fadeout .3s ease 3.7s; }
    .mensaje-toast.exito{ background:#4CAF50; }
    .mensaje-toast.error{ background:#f44336; }
    @keyframes fadein { from{opacity:0; transform:translate(-50%,20px);} to{opacity:1; transform:translate(-50%,0);} }
    @keyframes fadeout { from{opacity:1;} to{opacity:0;} }

    /* Checkbox pegado al texto y con sombreadito */
.opciones-ensalada {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
}

.opciones-ensalada .chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;          /* separa solo 6px entre tilde y texto */
  margin: 0;
  padding: 6px 10px; /* ‚Äúpill‚Äù */
  border: 1px solid #ddd;
  border-radius: 10px;
  background: #f6f6f6;
  cursor: pointer;
  user-select: none;
}

.opciones-ensalada .chip input[type="checkbox"] {
  margin: 0;         /* quita m√°rgenes por defecto del navegador */
  transform: translateY(0); /* evita desalineaci√≥n vertical */
}

  </style>
</head>
<body>

  <h1>¬ø¬°Qu√© comemos!? - Vegetariano</h1>
  <h2>Organizador de comidas semanal</h2>

  <div style="text-align:center; margin:20px 0;">
    <img src="plato-buen-comer.png" alt="Plato saludable" class="plato-saludable">
  </div>

  <h3 id="form-plato">Arm√° tu plato equilibrado</h3>

  <!-- Selector de Verduras y Ensaladas -->
   <select id="verdura">
    <option value="">-- Verduras y hortalizas --</option>
   
     <option value="lechuga">Lechuga</option>
     <option value="acelga">Acelga</option>
     <option value="espinaca">Espinaca</option>
     <option value="rucula">R√∫cula</option>
     <option value="pimiento">Pimiento</option>
     <option value="zapallo">Zapallo</option>
     <option value="zapallito">Zapallito</option>
     <option value="zucchini">Zucchini</option>
     <option value="berenjena">Berenjena</option>
     <option value="calabaza">Calabaza</option>
     <option value="choclo">Choclo</option>
     <option value="cebolla">Cebolla</option>
     <option value="palta">Palta</option>
      <option value="ensaladas">ü•ó Arm√° tu ensalada</option>
  <!-- üëá opci√≥n ‚Äúcustom‚Äù para inyectar la ensalada armada -->
  <option id="verduraCustom" value="" style="display:none;"></option>
  </select>

  
</select>

<div id="ensalada" class="subgrilla" style="display:none;">
  <h4>Arm√° tu ensalada</h4>
  <p>Seleccion√° las verduras:</p>
  <div class="opciones-ensalada">
    <label class="chip"><input type="checkbox" value="Lechuga">Lechuga</label>
    <label class="chip"><input type="checkbox" value="Tomate">Tomate</label>
    <label class="chip"><input type="checkbox" value="Cebolla">Cebolla</label>
    <label class="chip"><input type="checkbox" value="Pimiento">Pimiento</label>
    <label class="chip"><input type="checkbox" value="Palta">Palta</label>
    <label class="chip"><input type="checkbox" value="Zanahoria">Zanahoria</label>
    <label class="chip"><input type="checkbox" value="Pepino">Pepino</label>
    <label class="chip"><input type="checkbox" value="R√∫cula">R√∫cula</label>
    <label class="chip"><input type="checkbox" value="Espinaca">Espinaca</label>
    
  </div>
  <button type="button" onclick="copiarEnsalada()">Agregar ensalada</button>
</div>


  <select id="proteina">
    <option value="">-- Prote√≠nas vegetarianas --</option>
    <option value="huevo">Huevo</option>
    <option value="tofu">Tofu</option>
    <option value="milanesas de soja">Milanesas de soja</option>
    <option value="legumbres">Legumbres</option>
  </select>

  <select id="hidrato">
    <option value="">-- Hidratos de carbono --</option>
    <option value="arroz">Arroz</option>
    <option value="papa">Papa</option>
    <option value="fideos">Fideos</option>
  </select>

  <select id="completo">
    <option value="">-- Plato completo (opcional) --</option>
    <option value="lasagna vegetariana">Lasagna vegetariana</option>
    <option value="ensalada completa">Ensalada completa</option>
    <option value="tarta de verduras">Tarta de verduras</option>
  </select>

  <button onclick="validarPlato()">Validar y asignar</button>

  <h2>üóìÔ∏è Calendario semanal</h2>
  <p>Hac√© click en una comida para seleccionarla y despu√©s click en otra celda para intercambiarla o moverla. Toc√° en "Eliminar" para borrar un alimento.</p>

  <table id="calendario">
    <thead><tr><th>D√≠a</th><th>Almuerzo</th><th>Cena</th></tr></thead>
    <tbody id="calendario-body"></tbody>
  </table>

  <div class="top-buttons">
    <button onclick="descargarPDF()">üì• Descargar men√∫ semanal (PDF)</button>
    <button onclick="resetearCalendario()">üîÑ Resetear calendario</button>
    <button onclick="window.open('https://forms.gle/ddyvdbKZqHhuM8W77','_blank')">Validar nuevo Alimento o Receta</button>
    <button onclick="window.open('index.html','_blank')">Opci√≥n calendario Tradicional</button>
  </div>

  <script>

    document.getElementById('verdura').addEventListener('change', function () {
  const isSalad = this.value === 'ensaladas';
  document.getElementById('ensalada').style.display = isSalad ? 'block' : 'none';
});

function copiarEnsalada() {
  const checks = document.querySelectorAll('#ensalada input[type="checkbox"]:checked');
  const seleccion = Array.from(checks).map(c => c.value).join(', ');

  // Si no eligieron nada, no hacemos nada (ni mostramos mensajes)
  if (!seleccion) return;

  const verdSel = document.getElementById('verdura');
  const optCustom = document.getElementById('verduraCustom');

  // Cargar/mostrar el option custom con la ensalada armada
  optCustom.value = seleccion;
  optCustom.textContent = 'ü•ó Ensalada: ' + seleccion;
  optCustom.style.display = '';     // dejar de ocultar
  optCustom.selected = true;        // seleccionar ese option

  // Ocultar subgrilla y limpiar tildes
  document.getElementById('ensalada').style.display = 'none';
  document.querySelectorAll('#ensalada input[type="checkbox"]').forEach(c => c.checked = false);
}

    const dias = ['Lunes','Martes','Mi√©rcoles','Jueves','Viernes']; // ‚úÖ solo lunes a viernes
    let calendario = {}; let seleccion = null;
    dias.forEach(dia => calendario[dia] = { almuerzo:null, cena:null });

    function getSeleccionados(){
      const vb=document.getElementById('verdura').value;
      const sub=document.getElementById('ensalada').value;
      const verdura=(vb==='ensaladas' && sub)?sub:vb;
      return { verdura, proteina:document.getElementById('proteina').value, hidrato:document.getElementById('hidrato').value, completo:document.getElementById('completo').value };
    }

    function limpiarSelects(){ ['verdura','proteina','hidrato','completo'].forEach(id=>document.getElementById(id).value=''); document.getElementById('ensalada').style.display='none'; }

    function validarPlato() {
  const s = getSeleccionados();
  let valido = false, platoFinal = '';

  // ‚úÖ Reglas originales del vegetariano
  if (s.completo && !s.verdura && !s.proteina && !s.hidrato) {
    valido = true;
    platoFinal = s.completo;
  } 
  else if (s.verdura && s.proteina && s.hidrato && !s.completo) {
    valido = true;
    platoFinal = `${s.verdura}, ${s.proteina}, ${s.hidrato}`;
  }

  if (valido) {
    if (seleccion) {
      // üëâ Asignar directamente a la celda seleccionada
      const { dia, tipo } = seleccion;
      const otroTipo = (tipo === 'almuerzo') ? 'cena' : 'almuerzo';

      if (calendario[dia][otroTipo] === platoFinal) {
        mostrarMensaje(`‚ùå No pod√©s repetir "${platoFinal}" en ${dia}.`, 'error');
      }
      else if (contarRepeticiones(platoFinal) >= 2 && calendario[dia][tipo] !== platoFinal) {
        mostrarMensaje(`‚ùå El plato "${platoFinal}" ya fue asignado 2 veces esta semana.`, 'error');
      }
      else {
        calendario[dia][tipo] = platoFinal;
        actualizarCalendario();
        mostrarMensaje(`‚úÖ Plato agregado en ${dia} (${tipo}).`, 'exito');
      }
      seleccion = null;
      limpiarSelects();
    } else {
      // üëâ Si no hay celda seleccionada, usar tu l√≥gica original (azar + m√°ximo 2 veces)
      const ok = asignarAcalendario(platoFinal);
      if (ok) {
        mostrarMensaje('‚úÖ Plato v√°lido. Asignado correctamente al calendario.', 'exito');
      } else {
        mostrarMensaje(`‚ùå El plato "${platoFinal}" ya fue asignado 2 veces esta semana.`, 'error');
      }
      limpiarSelects();
    }
  } else {
    mostrarMensaje('‚ùå Combinaci√≥n no v√°lida. Volv√© a intentarlo.', 'error');
  }
}

function contarRepeticiones(plato) {
  let rep = 0;
  dias.forEach(d => {
    if (calendario[d].almuerzo === plato) rep++;
    if (calendario[d].cena === plato) rep++;
  });
  return rep;
}


    function asignarAcalendario(plato){
      let rep=0; dias.forEach(d=>{ if(calendario[d].almuerzo===plato) rep++; if(calendario[d].cena===plato) rep++; });
      if(rep>=2) return false;
      let disp=[...dias];
      while(disp.length){
        let dia=disp[Math.floor(Math.random()*disp.length)];
        let comida=Math.random()<.5?'almuerzo':'cena';
        if(!calendario[dia][comida]){
          if(calendario[dia].almuerzo!==plato && calendario[dia].cena!==plato){
            calendario[dia][comida]=plato; actualizarCalendario(); return true;
          }
        }
        disp.splice(disp.indexOf(dia),1);
      }
      return false;
    }

    function resetearCalendario(){ dias.forEach(d=>calendario[d]={almuerzo:null,cena:null}); actualizarCalendario(); }

    function actualizarCalendario(){
      guardarCalendario();
      const cuerpo=document.getElementById('calendario-body'); cuerpo.innerHTML='';
      const hoy=new Date(); let indiceHoy=hoy.getDay()-1; 
      if(indiceHoy<0||indiceHoy>4) indiceHoy=null; // ‚úÖ no resaltar finde
      dias.forEach((dia,i)=>{
        const esHoy = i===indiceHoy;
        cuerpo.innerHTML+=`
          <tr${esHoy?' style="background-color:#fff8dc;"':''}>
            <td data-label="D√≠a">${dia}</td>
            <td data-label="Almuerzo" onclick="seleccionarCelda('${dia}','almuerzo')">${crearContenidoCelda(dia,'almuerzo')}</td>
            <td data-label="Cena" onclick="seleccionarCelda('${dia}','cena')">${crearContenidoCelda(dia,'cena')}</td>
          </tr>`;
      });
    }

    function crearContenidoCelda(dia, tipo) {
  const plato = calendario[dia][tipo];
  if (!plato) {
    return '<span style="font-size:12px; color:#999;">Haga click para agregar un plato</span>';
  }
  return `${plato} <span class="menu-eliminar" role="button" tabindex="0" aria-label="Eliminar plato" onclick="eliminarPlato(event,'${dia}','${tipo}')">Eliminar</span>`;
}


    function eliminarPlato(e,dia,tipo){ e.stopPropagation(); calendario[dia][tipo]=null; actualizarCalendario(); }

    function seleccionarCelda(dia, tipo) {
  document.querySelectorAll('#calendario-body td').forEach(td => td.classList.remove('selected'));

  if (!seleccion) {
    seleccion = { dia, tipo };
    marcarCeldaSeleccionada(dia, tipo);
    if (!calendario[dia][tipo]) {
      document.getElementById('form-plato').scrollIntoView({ behavior: 'smooth' });
    }
    return;
  }

  const o = seleccion;
  const pO = calendario[o.dia][o.tipo];
  const pD = calendario[dia][tipo];

  if (o.dia === dia && o.tipo === tipo) {
    seleccion = null;
    actualizarCalendario();
    return;
  }

  if (!pO) {
    seleccion = { dia, tipo };
    marcarCeldaSeleccionada(dia, tipo);
    if (!pD) {
      document.getElementById('form-plato').scrollIntoView({ behavior: 'smooth' });
    }
    return;
  }

  const tmp = JSON.parse(JSON.stringify(calendario));
  tmp[dia][tipo] = pO;
  tmp[o.dia][o.tipo] = pD;

  const noDupMismoDia = d => {
    const a = tmp[d].almuerzo, c = tmp[d].cena;
    return !(a && c && a === c);
  };

  if (!noDupMismoDia(dia) || !noDupMismoDia(o.dia)) {
    mostrarMensaje('‚ùå No se puede repetir el mismo plato en el mismo d√≠a.', 'error');
    seleccion = null;
    actualizarCalendario();
    return;
  }

  calendario = tmp;
  seleccion = null;
  actualizarCalendario();
}


    function marcarCeldaSeleccionada(dia,tipo){ document.querySelectorAll('#calendario-body tr').forEach(f=>{ const c=f.children; if(c[0].innerText===dia){ if(tipo==='almuerzo') c[1].classList.add('selected'); if(tipo==='cena') c[2].classList.add('selected'); } }); }

    function guardarCalendario(){ localStorage.setItem('calendario_veg',JSON.stringify(calendario)); }
    function cargarCalendario(){ const g=localStorage.getItem('calendario_veg'); if(g){ try{ calendario=JSON.parse(g);}catch(e){console.error("Error al cargar calendario:",e);} } }

    window.onload=()=>{ cargarCalendario(); actualizarCalendario(); };

    document.getElementById('verdura').addEventListener('change', function(){ const ens=document.getElementById('ensalada'); if(this.value==='ensaladas'){ ens.style.display='block'; } else { ens.style.display='none'; ens.value=''; } });

    function mostrarMensaje(texto,tipo){ const m=document.getElementById('mensaje'); m.className="mensaje-toast"; m.classList.add(tipo); m.innerText=texto; m.style.display='block'; setTimeout(()=>{ m.style.display='none'; },4000); }
  </script>

  <div id="mensaje" class="mensaje-toast"></div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  async function descargarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFont("helvetica", "bold");
    doc.setFontSize(16);
    doc.text("üç¥ Men√∫ semanal", 20, 20);

    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);

    let y = 40;
    dias.forEach(dia => {
      const almuerzo = calendario[dia].almuerzo || "-";
      const cena = calendario[dia].cena || "-";
      doc.text(`${dia}:`, 20, y);
      doc.text(`Almuerzo: ${almuerzo}`, 40, y + 10);
      doc.text(`Cena: ${cena}`, 40, y + 20);
      y += 40;
    });

    doc.save("menu-semanal.pdf");
  }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
  function descargarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // T√≠tulo
    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.text("üç¥ Men√∫ semanal", 14, 20);

    // Armar la tabla
    const cabecera = [["D√≠a", "Almuerzo", "Cena"]];
    const filas = dias.map(dia => [
      dia,
      calendario[dia].almuerzo || "-",
      calendario[dia].cena || "-"
    ]);

    doc.autoTable({
      head: cabecera,
      body: filas,
      startY: 30,
      theme: "grid",
      headStyles: { fillColor: [143, 157, 104] }, // verde oliva del dise√±o
      styles: { halign: "center" }
    });

    // Guardar el PDF
    doc.save("menu-semanal.pdf");
  }
</script>
</body>
</html>


